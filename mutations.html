<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Mutation Experiment</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        #output {
            font-size: 24px;
            margin: 20px;
        }
        #controls {
            margin: 20px;
        }
    </style>
</head>
<body>
<h1>Random Mutation Experiment</h1>
<p>The purpose of this experiment is to show that random changes (mutations) cannot easily result in multiple correct changes happening at the same time.</p>
<p>Imagine you have a sentence, and some letters are wrong. You need to change those wrong letters to the correct ones, but all at the same time.</p>
<p>For example, if the target sentence is 'HELLO WORLD' and you need to change 'HXLXO WORXD' to 'HELLO WORLD', all the wrong letters ('X' and 'X') must change to 'E' and 'L' at the same time.</p>
<p>This experiment will show how difficult it is to achieve this with random changes.</p>
<div id="output">Initial String</div>
<div id="controls">
    <button id="startButton">Start</button>
    <button id="pauseButton">Pause</button>
</div>
<div id="counter">Mutations: 0</div>

<script>
    String.prototype.splice = function(idx, rem, str) {
        return this.slice(0, idx) + str + this.slice(idx + Math.abs(rem));
    };

    const targetPhrase = "METHINKS IT IS LIKE A WEASEL";
    let currentString = "";
    let incorrectIndices = [];
    let mutationCount = 0;
    let running = false;
    let interval;

    function generateRandomString(length) {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ ";
        let result = "";
        for (let i = 0; i < length; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    function mutateString(s, indices) {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ ";
        let sArray = s.split("");
        indices.forEach(index => {
            sArray[index] = chars.charAt(Math.floor(Math.random() * chars.length));
        });

        indices = indices.sort((a, b) => a - b);
        // console.log(indices);

        let mutatedString = sArray.join("");
        for (let i = 0; i < indices.length; i++)
        {
            mutatedString = mutatedString.splice(indices[i] + i * 2, 0, '$');
            mutatedString = mutatedString.splice(indices[i] + i * 2 + 2, 0, '£');
            // mutatedString[indices[i]] = '$' + mutatedString[indices[i]] + '£';

            // console.log('>' + mutatedString);
        }

        return mutatedString;
    }

    function startMutation() {
        running = true;
        interval = setInterval(mutate, 333); // 1/3 of a second
    }

    function pauseMutation() {
        running = false;
        clearInterval(interval);
    }

    function mutate() {
        if (!running) return;

        currentString = mutateString(currentString, incorrectIndices);
        mutationCount++;

        document.getElementById("output").innerHTML ='<p>' + currentString.replaceAll('$', '<span style="color: red">').replaceAll('£', '</span>') + '</p>';
        document.getElementById("counter").innerText = `Mutations: ${mutationCount}`;

        // console.log(currentString);
        // console.log('<p>' + currentString.replace('$', '<span style=\"color: red\">').replace('£', '</span>') + '</p>')
        currentString = currentString.replaceAll('$', '').replaceAll('£', '');

        if (incorrectIndices.every(index => currentString[index] === targetPhrase[index])) {
            pauseMutation();
            document.getElementById("output").innerText = `Target phrase achieved in ${mutationCount} mutations!`;
        }
    }

    document.getElementById("startButton").addEventListener("click", () => {
        if (!running) {
            startMutation();
        }
    });

    document.getElementById("pauseButton").addEventListener("click", pauseMutation);

    // Initialize the experiment
    function initialize() {
        const numIncorrect = prompt("Enter the number of letters to be incorrect:", "3");
        currentString = targetPhrase;
        incorrectIndices = [];
        while (incorrectIndices.length < numIncorrect) {
            const randomIndex = Math.floor(Math.random() * targetPhrase.length);
            if (!incorrectIndices.includes(randomIndex)) {
                incorrectIndices.push(randomIndex);
            }
        }

        document.getElementById("output").innerText = currentString;
        document.getElementById("counter").innerText = `Mutations: ${mutationCount}`;
    }

    initialize();
</script>
</body>
</html>
